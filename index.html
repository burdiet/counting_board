
<html>
<head>
<title>Counting Board</title>
<link rel="shortcut icon" href="cblogo.ico" /> 
<script type="text/javascript">
var cdNumber1 = 0;
var cdNumber2 = 0;
var timer1,timer2;
// idle=0, counting=1, pause=2, ready=3;
var tAstate = 0,tBstate = 0;
var scoreA = 0,scoreB = 0;
var starttime = 0,endtime = 0;
var longpressed = false,pressing;
var cd = {
  tA : null,
  tB : null,
};

function convertIntView(number){ 
  if(number>=0 && number <10){
    return ("0"+number.toString());
  }else{
    return number.toString();
  }
}

function startCount(timer,cdNumber){
    timer.style.backgroundColor = "yellow";
    timer.style.color = "#04060F";
    cd[timer.id] = setInterval(function(){
      cdNumber--;
      if (cdNumber < 0) {
        this.reset(timer);
      }else{
        this.setCd(timer.id,cdNumber);
        var mins = Math.floor(cdNumber / 60);
        var secs = Math.floor(cdNumber % 60);
        timer.innerHTML = convertIntView(mins)+" : "+ convertIntView(secs);
      }
    },1000);
}

function getCountDownId(timerid){
  return cd[timerid];
}

function getCd(timer){
    if (timer=='tA'){
    return cdNumber1;
  }else if (timer=='tB'){
    return cdNumber2;
  }
}

function setCd(timer,number){
    if (timer=='tA'){
    cdNumber1 = number;
  }else if (timer=='tB'){
    cdNumber2 = number;
  }
}

function getState(timer){
  if (timer=='tA'){
    return tAstate;
  }else if (timer=='tB'){
    return tBstate;
  }
}

function setState(timer,state){
  if (timer=='tA'){
    tAstate = state;
  }else if (timer=='tB'){
    tBstate = state;
  }
}

function setTimer(e){
  if (!longpressed){
    var timerid = e.srcElement.id;
    timer = e.srcElement;
    timer_state = this.getState(timerid);
    switch(timer_state){
      case 0:
        do {
          var time = parseFloat(window.prompt("please enter time (minutes)","6"));
        } while(isNaN(time)||time<=0);
        this.setCd(timerid,time*60);
        var mins = Math.floor(time);
        var secs = Math.floor((time*60) % 60);
        timer.innerHTML = convertIntView(mins)+" : "+ convertIntView(secs);
        this.setState(timerid,3);
        break;
      case 1:
        countdownid = this.getCountDownId(timerid);
        clearInterval(countdownid);
        timer.style.backgroundColor = "#A79493";
        timer.style.color = "white";
        this.setState(timerid,2);
        break;
      case 2:
        this.setState(timerid,1);
        this.startCount(timer,this.getCd(timerid));
        break;
      case 3:
        this.setState(timerid,1);
        this.startCount(timer,this.getCd(timerid)); 
    }
  }
  else{
      e.preventDefault();
      e.stopImmediatePropagation();
  }
}

function add(e){
  console.log(e.srcElement.id)
  if (e.srcElement.id=='left'){
    console.log('add')
    scoreA+=1;
    document.getElementById('lscore').innerHTML = scoreA;
  }else if(e.srcElement.id=='right'){
    scoreB+=1;
    document.getElementById('rscore').innerHTML = scoreB;
  }
}

function minus(e){
  if (e.srcElement.id=='left'&&scoreA>0){
    scoreA-=1;
    document.getElementById('lscore').innerHTML = scoreA;
  }else if(e.srcElement.id=='right'&&scoreB>0){
    scoreB-=1;
    document.getElementById('rscore').innerHTML = scoreB;
  }
}

  function reset(timer){
    countdownid = this.getCountDownId(timer.id);
    this.setState(timer.id,0);
    clearInterval(countdownid);
    timer.innerHTML = "00 : 00";     
    timer.style.backgroundColor = "#A79493";
    timer.style.color = "white";
  }
  
  function mousedown(e){
    starttime = new Date().getTime();
    pressing = setInterval(function(){
      pressedtime = new Date().getTime();
      if (pressedtime - starttime > 150){
        e.srcElement.style.backgroundColor = "#F4F2B1";
      }
    },80);
  }

  function mouseup(e){
    clearInterval(pressing);
    endtime = new Date().getTime();
    var timer = e.srcElement;
    if (endtime - starttime > 150){
      longpressed = true;
      this.reset(timer);
    }else{
      longpressed = false;
    }
  }

</script>
<link rel="stylesheet" type="text/css" href="counting_board.css">
</head> 
<body>
  <div id='leftside'>
    <div id='name'>紅隊</div>
    <div id='box'>
      <div id="tA" class="boardbox" onclick="setTimer(event)" onmousedown="mousedown(event)" onmouseup="mouseup(event)">00 : 00</div>
    </div>
    <div id='scorebox'>
      <div class='scorebar'>
        <img id='left' class='minus' src='minus.png' onclick="minus(event)"></img>
      </div>
      <div id='lscore' class='scorebar score'>0</div>
      <dissv class='scorebar'>
        <img id='left' class='add' src='add.png' onclick="add(event)"></img>
      </div>
    </div>
  </div>
  <div id='rightside'>
    <div id='name'>藍隊</div>
    <div id='box'>
      <div id="tB" class="boardbox" onclick="setTimer(event)" onmousedown="mousedown(event)" onmouseup="mouseup(event)">00 : 00</div>
    </div>
    <div id='scorebox'>
      <div class='scorebar'>
        <img id='right' class='minus' src='minus.png' onclick="minus(event);"></img>
      </div>
      <div id='rscore' class='scorebar score'>0</div>
      <dissv class='scorebar'>
        <img id='right' class='add' src='add.png' onclick="add(event);"></img>
      </div>
  </div>
</body> 
</html>
